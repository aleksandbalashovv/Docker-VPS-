# Docker-VPS (Среда исполнения для серверного приложения)

## Описание

Это инфраструктурный проект, целью которого является построение **воспроизводимой, контролируемой и безопасной среды исполнения** для серверного приложения (например, Minecraft-сервер).  
Фокус проекта направлен на инфраструктурное мышление: диагностику среды, подготовку окружения, разделение ролей, обеспечение безопасности и наблюдаемости.

Проект служит в качестве шаблона для работы с VPS и Docker.

---

## Архитектура и принципы

### Задача

Создать инструментальную базу и практику для:

- подготовки рабочей среды как на локальной машине, так и на VPS;
- исключения неопределённых состояний системы;
- контроля и диагностики перед запуском приложения;
- разделения ответственности между инфраструктурой и приложением;
- обеспечения предсказуемых шагов запуска.

### Основные инженерные принципы

1. Диагностика **предшествует** действиям.
2. Все шаги и выводы — документированы.
3. Инфраструктурная часть отделена от прикладной.
4. Среда должна быть готова **до запуска** сервера.
5. Разграничение прав пользователей и уровней доступа.

---

## Подготовка локальной среды (macOS)

На этапе исследования:

- проверено состояние Docker Desktop, ресурсов системы и использования диска;
- выявлены особенности Docker на macOS, связанные с ограничением дискового пространства;
- настроена локальная диагностика состояния среды.

Среда подготовлена к работе с контейнерами.

---

## Скрипты диагностики и контроля

Для обеспечения предсказуемости состояния системы были созданы и использованы следующие скрипты:

- `system_check.sh` — диагностика CPU, памяти, дискового пространства.
- `docker_check.sh` — проверка статуса Docker, лимитов и использования.
- `watchdog.sh` — наблюдение за процессами и потреблением ресурсов.
- `network_check.sh` — проверка сетевого окружения и портов.
- `integrity_baseline.sh` — базовая проверка целостности файлов.
- `preflight.sh` — объединяет все проверки в единую точку входа.

Эти скрипты позволяют получать состояние среды в любой момент и принимать решение о её готовности.

---

## Развёртывание на VPS

### Окружение

Сервер использует:

- Ubuntu 24.04;
- systemd для управления системными сервисами;
- Docker, интегрированный с systemd через socket-активацию.

### Пользователи

- `root` — для администрирования системы;
- `minecraft` — отдельный пользователь для запуска и управления сервером (не привязан к root).

Такой подход обеспечивает:

- отслеживаемость исполнения (файлы и процессы принадлежат отдельному пользователю);
- изоляцию прав;
- безопасность и структурирование окружения.

---

## Настройка SSH

Аутентификация производится с помощью SSH-ключей (ed25519):

- пароли на уровне SSH отключены или служат резервом;
- права на каталоги и ключи настроены строго (700/600);
- публичный ключ добавлен в `authorized_keys`;
- доступ к серверу обеспечивается только по ключу.

На стороне клиента для удобства используется ssh-agent для хранения расшифровки ключа.

---

## Контейнеризация

Контейнерный образ базируется на минимальном runtime (например, Java-runtime):

- среда контейнера минимальна и воспроизводима;
- Dockerfile не содержит ненужных пакетов;
- все зависимости и окружение определены декларативно.

Это обеспечивает переносимость и единообразие поведения между локальной и удалённой средой.

---

## Результат

На текущем этапе достигнуто:

- системное понимание ответственности компонентов;
- воспроизводимая и предсказуемая среда исполнения;
- автоматические проверки готовности;
- разграничение прав пользователей;
- готовность к запуску серверного приложения.

---

## Дальнейшие шаги

Проект можно расширить:

- запуском приложения (например, Minecraft-сервера) внутри контейнера;
- настройкой логирования и метрик;
- добавлением резервного копирования;
- интеграцией CI/CD (например, через GitHub Actions);
- формализацией контракта для других участников разработки.

---

## Структура
```text
docker-vps/
├── scripts/
│ ├── system_check.sh
│ ├── docker_check.sh
│ ├── watchdog.sh
│ ├── network_check.sh
│ ├── integrity_baseline.sh
│ └── preflight.sh
├── Dockerfile
```


---

## Заключение

Этот репозиторий — не про конкретное серверное приложение.  
Это про **осмысленную подготовку инфраструктуры**, где каждый шаг фиксирован, проверяем и воспроизводим.



